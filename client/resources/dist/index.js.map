{
  "version": 3,
  "sources": ["../../src/index.ts"],
  "sourcesContent": ["\ninterface VSCodeApi {\n  postMessage(message: unknown): void;\n  getState(): unknown;\n  setState(state: unknown): void;\n}\nimport {WebviewMessage,RunnerBase} from '../../src/extension.js'\nimport {s2t} from '@yigal/base_types'\nfunction create_terminal_element(parent: HTMLElement,id:string): HTMLElement {\n  const ans=parent.querySelector(`#${id}`)\n  if (ans!=null)\n    return ans as HTMLElement //todo check that it is HTMLElement\n  const template = document.createElement(\"template\")\n  template.innerHTML = `\n<div class=\"term_panel\" id=\"${id} style={display='block'};\">\n  <table class=stats>\n  </table>\n  <div class=term>\n  </div>\n</div>\n  `.trim();\n  const element = template.content.firstElementChild as HTMLElement;\n  parent.appendChild(element);\n  return element;\n}\nfunction query_selector(el:HTMLElement,selector:string){\n    const ans=el.querySelector(selector);\n    if (ans==null ||  !(ans instanceof HTMLElement))\n      throw new Error('selector not found or not html element')  \n    return ans\n}\nfunction update_child_html(el: HTMLElement, selector: string, html: string) {\n  const child = query_selector(el,selector)\n  if (child.innerHTML === html) return; // skip if same\n  child.innerHTML = html;\n}\nfunction append(txt:string,el:HTMLElement|null=null){\n  if (el==null)\n    el=document.getElementById('terminal')\n  if (el==null)\n    return\n  el.insertAdjacentHTML('beforeend', `${txt}\\n`);\n  el.scrollTop = el.scrollHeight;\n}\nfunction calc_stats_html(new_runner:RunnerBase){\n  return Object.entries(new_runner).map(([k,v])=>`<tr>\n      <td><span class=value>${k} = </span>${v}</td>\n    </tr>`).join('\\n')\n}\nfunction calc_new_lines(new_runner:RunnerBase){\n  return new_runner.output.map((line)=>`<div class=${line.type}>${line.data}</div>`).join('\\n')\n}\nclass Terminal{\n  el:HTMLElement\n  constructor(\n    public parent:HTMLElement,\n    public runner:RunnerBase,\n  ){\n    this.el=create_terminal_element(parent,runner.id)\n    this.update(runner)\n  }\n  update(new_runner:RunnerBase){\n    const term=query_selector(this.el,'.term')\n    const new_lines=calc_new_lines(new_runner)\n    append(new_lines,term)\n    const stats=calc_stats_html(new_runner)\n    update_child_html(this.el,'.stats',stats)\n    this.runner=new_runner//should we at all hold on to it\n  }\n}\nclass Terminals{\n  terminals:s2t<Terminal>={}\n  constructor(\n    public parent:HTMLElement\n  ){\n  }\n  get_terminal(runner:RunnerBase){\n    const ans=this.terminals[runner.id] ??= new Terminal(this.parent, runner)\n    return ans\n  }\n}\n\n\ndeclare function acquireVsCodeApi(): VSCodeApi;\n\nconst vscode = acquireVsCodeApi();\n\n\nfunction start(){\n  console.log('start')\n  const sendButton = document.getElementById('sendMessage');\n  const terminals=new Terminals(document.body)\n  if (sendButton==null){\n    console.warn(' div not found')\n    return\n  }\n\n  sendButton.addEventListener('click', () => {\n    append('buttonClick clicked');\n    vscode.postMessage({\n          command: 'buttonClick',\n          text: 'Hello from webview!'\n      });\n  });\n  document.getElementById('getReport')!.addEventListener('click', () => {\n    append('getReport clicked')\n    const message:WebviewMessage={\n          command: 'get_report',\n          text: 'Hello from webview!'\n      }\n    vscode.postMessage(message);\n  });  \n\n  // Listen for messages from the extension\n  window.addEventListener('message',  (event:MessageEvent<WebviewMessage>) => {\n      const message = event.data;\n      switch (message.command) {\n          case 'RunnerReport':{\n            for (const runner of message.runners)\n              terminals.get_terminal(runner)\n            const json=JSON.stringify(message.runners,null,2)\n            void navigator.clipboard.writeText(json);\n            append(json)\n            break\n          }\n          case 'updateContent':\n            append(message.text||'<no message>')\n            break;\n      }\n  });\n}\nstart()"],
  "mappings": "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",
  "names": []
}
