{
  "version": 3,
  "sources": ["../../../node_modules/ansi-html/index.js", "../../src/index.ts"],
  "sourcesContent": ["'use strict'\n\nmodule.exports = ansiHTML\n\n// Reference to https://github.com/sindresorhus/ansi-regex\nvar _regANSI = /(?:(?:\\u001b\\[)|\\u009b)(?:(?:[0-9]{1,3})?(?:(?:;[0-9]{0,3})*)?[A-M|f-m])|\\u001b[A-M]/\n\nvar _defColors = {\n  reset: ['fff', '000'], // [FOREGROUD_COLOR, BACKGROUND_COLOR]\n  black: '000',\n  red: 'ff0000',\n  green: '209805',\n  yellow: 'e8bf03',\n  blue: '0000ff',\n  magenta: 'ff00ff',\n  cyan: '00ffee',\n  lightgrey: 'f0f0f0',\n  darkgrey: '888'\n}\nvar _styles = {\n  30: 'black',\n  31: 'red',\n  32: 'green',\n  33: 'yellow',\n  34: 'blue',\n  35: 'magenta',\n  36: 'cyan',\n  37: 'lightgrey'\n}\nvar _openTags = {\n  '1': 'font-weight:bold', // bold\n  '2': 'opacity:0.5', // dim\n  '3': '<i>', // italic\n  '4': '<u>', // underscore\n  '8': 'display:none', // hidden\n  '9': '<del>' // delete\n}\nvar _closeTags = {\n  '23': '</i>', // reset italic\n  '24': '</u>', // reset underscore\n  '29': '</del>' // reset delete\n}\n\n;[0, 21, 22, 27, 28, 39, 49].forEach(function (n) {\n  _closeTags[n] = '</span>'\n})\n\n/**\n * Converts text with ANSI color codes to HTML markup.\n * @param {String} text\n * @returns {*}\n */\nfunction ansiHTML (text) {\n  // Returns the text if the string has no ANSI escape code.\n  if (!_regANSI.test(text)) {\n    return text\n  }\n\n  // Cache opened sequence.\n  var ansiCodes = []\n  // Replace with markup.\n  var ret = text.replace(/\\033\\[(\\d+)m/g, function (match, seq) {\n    var ot = _openTags[seq]\n    if (ot) {\n      // If current sequence has been opened, close it.\n      if (!!~ansiCodes.indexOf(seq)) { // eslint-disable-line no-extra-boolean-cast\n        ansiCodes.pop()\n        return '</span>'\n      }\n      // Open tag.\n      ansiCodes.push(seq)\n      return ot[0] === '<' ? ot : '<span style=\"' + ot + ';\">'\n    }\n\n    var ct = _closeTags[seq]\n    if (ct) {\n      // Pop sequence\n      ansiCodes.pop()\n      return ct\n    }\n    return ''\n  })\n\n  // Make sure tags are closed.\n  var l = ansiCodes.length\n  ;(l > 0) && (ret += Array(l + 1).join('</span>'))\n\n  return ret\n}\n\n/**\n * Customize colors.\n * @param {Object} colors reference to _defColors\n */\nansiHTML.setColors = function (colors) {\n  if (typeof colors !== 'object') {\n    throw new Error('`colors` parameter must be an Object.')\n  }\n\n  var _finalColors = {}\n  for (var key in _defColors) {\n    var hex = colors.hasOwnProperty(key) ? colors[key] : null\n    if (!hex) {\n      _finalColors[key] = _defColors[key]\n      continue\n    }\n    if ('reset' === key) {\n      if (typeof hex === 'string') {\n        hex = [hex]\n      }\n      if (!Array.isArray(hex) || hex.length === 0 || hex.some(function (h) {\n        return typeof h !== 'string'\n      })) {\n        throw new Error('The value of `' + key + '` property must be an Array and each item could only be a hex string, e.g.: FF0000')\n      }\n      var defHexColor = _defColors[key]\n      if (!hex[0]) {\n        hex[0] = defHexColor[0]\n      }\n      if (hex.length === 1 || !hex[1]) {\n        hex = [hex[0]]\n        hex.push(defHexColor[1])\n      }\n\n      hex = hex.slice(0, 2)\n    } else if (typeof hex !== 'string') {\n      throw new Error('The value of `' + key + '` property must be a hex string, e.g.: FF0000')\n    }\n    _finalColors[key] = hex\n  }\n  _setTags(_finalColors)\n}\n\n/**\n * Reset colors.\n */\nansiHTML.reset = function () {\n  _setTags(_defColors)\n}\n\n/**\n * Expose tags, including open and close.\n * @type {Object}\n */\nansiHTML.tags = {}\n\nif (Object.defineProperty) {\n  Object.defineProperty(ansiHTML.tags, 'open', {\n    get: function () { return _openTags }\n  })\n  Object.defineProperty(ansiHTML.tags, 'close', {\n    get: function () { return _closeTags }\n  })\n} else {\n  ansiHTML.tags.open = _openTags\n  ansiHTML.tags.close = _closeTags\n}\n\nfunction _setTags (colors) {\n  // reset all\n  _openTags['0'] = 'font-weight:normal;opacity:1;color:#' + colors.reset[0] + ';background:#' + colors.reset[1]\n  // inverse\n  _openTags['7'] = 'color:#' + colors.reset[1] + ';background:#' + colors.reset[0]\n  // dark grey\n  _openTags['90'] = 'color:#' + colors.darkgrey\n\n  for (var code in _styles) {\n    var color = _styles[code]\n    var oriColor = colors[color] || '000'\n    _openTags[code] = 'color:#' + oriColor\n    code = parseInt(code)\n    _openTags[(code + 10).toString()] = 'background:#' + oriColor\n  }\n}\n\nansiHTML.reset()\n", "import ansiHTML from 'ansi-html';\ninterface VSCodeApi {\n  postMessage(message: unknown): void;\n  getState(): unknown;\n  setState(state: unknown): void;\n}\nimport {WebviewMessage,RunnerBase} from '../../src/extension.js'\nimport {s2t} from '@yigal/base_types'\nfunction create_terminal_element(parent: HTMLElement,id:string): HTMLElement {\n  const ans=parent.querySelector(`#${id}`)\n  if (ans!=null)\n    return ans as HTMLElement //todo check that it is HTMLElement\n  const template = document.createElement(\"template\")\n  template.innerHTML = `\n<div class=\"term_panel\" id=\"${id} style={display='block'};\">\n  <table class=stats>\n  </table>\n  <div class=term>\n  </div>\n</div>\n  `.trim();\n  const element = template.content.firstElementChild as HTMLElement;\n  parent.appendChild(element);\n  return element;\n}\nfunction query_selector(el:HTMLElement,selector:string){\n    const ans=el.querySelector(selector);\n    if (ans==null ||  !(ans instanceof HTMLElement))\n      throw new Error('selector not found or not html element')  \n    return ans\n}\nfunction update_child_html(el: HTMLElement, selector: string, html: string) {\n  const child = query_selector(el,selector)\n  if (child.innerHTML === html) return; // skip if same\n  child.innerHTML = html;\n}\nfunction append(txt:string,el:HTMLElement|null=null){\n  if (el==null)\n    el=document.getElementById('terminal')\n  if (el==null)\n    return\n  el.insertAdjacentHTML('beforeend', `${txt}\\n`);\n  el.scrollTop = el.scrollHeight;\n}\nfunction calc_stats_html(new_runner:RunnerBase){\n  return Object.entries(new_runner).map(([k,v])=>`<tr>\n      <td><span class=value>${k} = </span>${v}</td>\n    </tr>`).join('\\n')\n}\nfunction calc_new_lines(new_runner:RunnerBase){\n  return new_runner.output.map((line)=>`<div class=${line.type}>${ansiHTML(line.data)}</div>`).join('\\n')\n}\nclass Terminal{\n  el:HTMLElement\n  constructor(\n    public parent:HTMLElement,\n    public runner:RunnerBase,\n  ){\n    this.el=create_terminal_element(parent,runner.id)\n    //this.update(runner) fixed bug by commenting this out\n  }\n  update(new_runner:RunnerBase){\n    const term=query_selector(this.el,'.term')\n    const new_lines=calc_new_lines(new_runner)\n    append(new_lines,term)\n    const stats=calc_stats_html(new_runner)\n    update_child_html(this.el,'.stats',stats)\n    this.runner=new_runner//should we at all hold on to it\n  }\n}\nclass Terminals{\n  terminals:s2t<Terminal>={}\n  constructor(\n    public parent:HTMLElement\n  ){\n  }\n  get_terminal(runner:RunnerBase){\n    const ans=this.terminals[runner.id] ??= new Terminal(this.parent, runner)\n    return ans\n  }\n}\n\n\ndeclare function acquireVsCodeApi(): VSCodeApi;\n\nconst vscode = acquireVsCodeApi();\n\n\nfunction start(){\n  console.log('start')\n  const sendButton = document.getElementById('sendMessage');\n  const terminals=new Terminals(document.body)\n  if (sendButton==null){\n    console.warn(' div not found')\n    return\n  }\n\n  sendButton.addEventListener('click', () => {\n    append('buttonClick clicked');\n    vscode.postMessage({\n          command: 'buttonClick',\n          text: 'Hello from webview!'\n      });\n  });\n  document.getElementById('getReport')!.addEventListener('click', () => {\n    append('getReport clicked')\n    const message:WebviewMessage={\n          command: 'get_report',\n          text: 'Hello from webview!'\n      }\n    vscode.postMessage(message);\n  });  \n\n  // Listen for messages from the extension\n  window.addEventListener('message',  (event:MessageEvent<WebviewMessage>) => {\n      const message = event.data;\n      switch (message.command) {\n          case 'RunnerReport':{\n            for (const runner of message.runners)\n              terminals.get_terminal(runner).update(runner)\n            //const json=JSON.stringify(message.runners,null,2)\n            //void navigator.clipboard.writeText(json);\n            //append(json)\n            break\n          }\n          case 'updateContent':\n            append(message.text||'<no message>')\n            break;\n      }\n  });\n}\nstart()"],
  "mappings": "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",
  "names": ["ansiHTML", "ansiHTML"]
}
